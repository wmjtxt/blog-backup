---
title: 克隆Deepin系统
date: 2019-06-27 16:08:26
tags: Linux
categories: 电脑配置
top: 0
---

换了新电脑，就想把原来的系统迁移到新电脑上，毕竟新配置一个系统还是挺麻烦的。在论坛搜了一下，看到有说可以clone分区。然后就试了试，开始遇到一些问题，不过后来还是成功了。
<!--more-->

想看具体步骤可以跳转到[实施步骤](#实施步骤)，或者[精简版](#精简版) 。

新电脑是AMD锐龙处理器，自带Windows10，原Deepin系统是在大小110G左右的固态硬盘上，需要把它克隆到一个238G左右的移动固态硬盘。

然后就遇到一个问题：克隆完成后，将238G的硬盘连到新电脑，无法从该硬盘启动，Boot Device只显示电脑自带的硬盘而不显示外接硬盘，不知道是新电脑的问题还是锐龙处理器的问题，总之就是没办法启动克隆的系统。

所谓兵来将挡水来土掩，问题总是有解决的办法，很快就想到一个：那就是在电脑自带的硬盘安装一个Deepin系统，由它来引导。果不其然，安装好以后，再启动的时候就可以看到238G硬盘上的系统了，启动它也没什么问题。这样，克隆系统就大功告成。

ps : 一直以来，我都是用Windows10+Deepin双系统，efi引导启动(引导这块不太懂，我是先装好Windows10，再安装Deepin，然后开机就看到引导界面了，所以应该是Deepin自带的引导程序)。

至于，为什么我不用Deepin 15.10(以下简称15.10)了？其实先前是打算趁这次换电脑改用Deepin 15.10而放弃原来的Deepin 15.9(下称15.9)的(从15.5开始用，一路升级到15.9)，因为15.10是第一个stable版本，而且原来的unstable版本官方好像是今年7月以后不再更新了。

所以新电脑一到，我就在238G移动固态上安装了15.10，一开始没发现什么大问题，只是**引导有点问题**：每次从Windows10重启，无法正常进入引导界面。这也许是本地硬盘Windows10+移动硬盘Deepin的问题，也可能是AMD处理器的问题。

另外，在安装一个vim插件的时候（vim-instant-markdown），需要安装nodejs，而在15.10安装nodejs默认版本是4.8，在15.9安装是8.11，不知道是不是由于这个原因，总之结果就是**vim-instant-markdown在15.10用不了**，尝试了各种方法结果还是不行。

综上，我就决定暂时放弃15.10了，虽然[解决办法]里在新电脑自带硬盘安装的系统是15.10，但那只是工具而已，以后的主力系统还是15.9。或许以后还有机会再用15.10或者别的linux系统。

### 实施步骤

大致说一下实施步骤，因为我先后尝试了多次，所以这里就不赘述，只说我认为是必要的步骤，如果遇到问题，欢迎留言交流。

* 1.准备工作

    * 原始系统，简称**Deepin-老大**；目标系统，也就是克隆系统，简称**Deepin-小二**。
    
    * 一个第三方Deepin系统（我是在另一个移动机械硬盘上安装过一个Deepin 15.7，正好派上用场），简称**Deepin-小三**。
    用live系统应该也可以，不过我没有试。如果在Deepin-老大上执行clone操作的话，会提示有个错误，好像是让你重启进入live系统再clone（我第一次是这样弄的，记不太清了，后来都是在第三方系统clone的）。
    
    * 安装Clone软件（中文名是备份还原工具），在深度商店里就有。
    
    * 在新电脑自带硬盘压缩出一个60G大小的空间并新建分区（这个过程是在自带Windows10系统进行），安装Deepin系统，简称**Deepin-小四**。

* 2.克隆系统

打开Clone软件，第一步选择操作介质: 分区，选择介质对应的操作: 克隆分区，然后点击下一步，选择原始分区和目标分区，点击开始克隆，等待完成。

* 3.在新电脑启动

克隆完成后，建议就转移到新电脑，先启动**Deepin-小四**，执行命令`sudo update-grub`，然后重启就可以进入引导界面，并发现里面有**Deepin-小二**，就说明克隆成功了。

之所以不建议在旧电脑启动**Deepin-小二**，是因为在旧电脑，**Deepin-老大**和**Deepin-小二**同时存在，引导程序可能对他们在识别上有点问题。
我在**Deepin-小三**执行`sudo update-grub`后，引导程序的确发现了这两个在不同位置的一模一样的系统，但启动的时候不论点击哪一个，似乎启动的都是原来的**Deepin-小二**，应该是**Deepin-小二**把**Deepin-老大**给覆盖了。

ps : 晚上我又测试了一下，把原系统升级了，15.9.3 unstable --> 15.10.1 stable，看来Deepin支持从unstable直接升级到stable版本了。还有就是升级过后，把**Deepin-小二**和**Deepin-老大**放到一起，开机，系统久久不能启动，大概维持了5分钟。
然后，我觉得情况不对劲，就强制关机，把**Deepin-小二**放到新电脑上，开机，提示有些错误，然后执行检查，最后很快正常启动。看来那5分钟旧电脑还是做了些什么，试图区分老大和小二。还好我及时制止了，不然可能要出大事的(认真脸)。
算了算了，以后他们还是不要相见了，这让我想起一个电影，好像是叫做《月球》，挺悲伤的。关于克隆，确实有些东西让人（系统）难以接受。
* 4.解决Deepin-小二分区大小问题

启动**Deepin-小二**后，你也许会发现这个问题：`df -h`命令的结果显示，系统盘大小是110G（原系统Deepin-老大所在分区的大小），而`sudo fdisk -l`命令显示系统盘分区大小是238G（就是克隆操作目标硬盘的大小）。

那些多余的空间去哪了？能不能找回来呢？答案是可以！

只需要执行如下命令：

`sudo resize2fs /dev/sda1`

其中`/dev/sda1`是系统**Deepin-小二**所在的分区名字。

* 5.领衔主演

|姓名|版本|系统盘大小|
|:-:|:-:|:-:|
|Deepin-老大|15.9.3|110G|
|Deepin-小二|15.9.3|238G|
|Deepin-小三|15.7.0|80G|
|Deepin-小四|15.10.1|60G|


### 精简版

* 1.在第三方系统上，使用Clone软件将待克隆系统从原始分区克隆到目标分区。
* 2.启动克隆系统后，执行`sudo resize2fs /dev/sda1`，其中`/dev/sda1`是克隆系统所在的分区名字。
* **注意**：不要在原电脑启动克隆系统


### 后记

还有一些别的办法克隆系统，比如先备份，再还原，不再一一尝试啦，毕竟系统只是工具，弄好了就该办正事了，这才是最重要的。
